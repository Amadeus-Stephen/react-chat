{"ast":null,"code":"var _jsxFileName = \"/home/amadeus/react/react-chat/frontend/src/componets/chat/chatPage.js\";\nimport React, { Component } from \"react\";\nimport ChatLogs from \"./chatLogs\";\nimport { Redirect } from \"react-router-dom\";\n\nclass ChatPage extends Component {\n  constructor(props) {\n    super(props);\n    this._isMounted = false;\n\n    this.onTextChange = e => {\n      this.setState({\n        [e.target.name]: e.target.value\n      });\n    };\n\n    this.state = {\n      msg: \"\",\n      chat: [],\n      redirectTo: null\n    };\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n    this.props.socket.emit(\"connect_to\", {\n      socket: this.props.id\n    });\n    this.props.socket.on(\"connect_to\", data => {\n      //this.setState({ chat: data });\n      if (data.error) {\n        this.props.addFlash({\n          success: false,\n          msg: data.error.msg\n        });\n\n        if (this._isMounted) {\n          this.setState({\n            redirectTo: \"/\"\n          });\n        }\n      } else {\n        if (this._isMounted) {\n          console.log(data);\n          this.setState({\n            chat: data\n          });\n        }\n      }\n    });\n    this.props.socket.on(\"chat_message\", data => {\n      console.log(data);\n\n      if (this._isMounted) {\n        this.setState({\n          chat: [...this.state.chat, {\n            user: data.user,\n            msg: data.msg\n          }]\n        });\n\n        if (this.props.username === data.user) {\n          this.chatbox.scrollTo(0, this.chatbox.scrollHeight);\n        }\n      }\n    });\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n\n  handleSubmit(event) {\n    event.preventDefault();\n    console.log(\"hello\");\n    this.props.socket.emit(\"chat_message\", {\n      user: this.props.username,\n      msg: this.state.msg\n    });\n\n    if (this._isMounted) {\n      this.setState({\n        msg: \"\"\n      });\n    }\n  }\n\n  renderChat() {\n    const {\n      chat\n    } = this.state;\n    return chat.map(({\n      user,\n      msg\n    }, idx) => {\n      if (user === this.props.username) {\n        return /*#__PURE__*/React.createElement(ChatLogs, {\n          key: idx,\n          msg: msg,\n          user: user,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 68,\n            columnNumber: 16\n          }\n        });\n      }\n    });\n  }\n\n  render() {\n    if (this.state.redirectTo) {\n      return /*#__PURE__*/React.createElement(Redirect, {\n        to: {\n          pathname: this.state.redirectTo\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 14\n        }\n      });\n    } else {\n      return /*#__PURE__*/React.createElement(\"div\", {\n        className: \"background ss\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"card cscard chat\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 79,\n          columnNumber: 11\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"chatbox ss3\",\n        ref: c => this.chatbox = c,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 13\n        }\n      }, this.renderChat()), /*#__PURE__*/React.createElement(\"form\", {\n        onSubmit: this.handleSubmit,\n        className: \"input-group mb-3\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 13\n        }\n      }, /*#__PURE__*/React.createElement(\"div\", {\n        className: \"input-group-prepend\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"button\", {\n        className: \"btn text-left  csnav-btn \",\n        type: \"submit\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 17\n        }\n      }, \"Send\")), /*#__PURE__*/React.createElement(\"input\", {\n        onChange: e => this.onTextChange(e),\n        value: this.state.msg,\n        name: \"msg\",\n        className: \"form-control\",\n        placeholder: \"\",\n        type: \"text\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 15\n        }\n      }))));\n    }\n  }\n\n}\n\nexport default ChatPage;","map":{"version":3,"sources":["/home/amadeus/react/react-chat/frontend/src/componets/chat/chatPage.js"],"names":["React","Component","ChatLogs","Redirect","ChatPage","constructor","props","_isMounted","onTextChange","e","setState","target","name","value","state","msg","chat","redirectTo","handleSubmit","bind","componentDidMount","socket","emit","id","on","data","error","addFlash","success","console","log","user","username","chatbox","scrollTo","scrollHeight","componentWillUnmount","event","preventDefault","renderChat","map","idx","render","pathname","c"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport ChatLogs from \"./chatLogs\";\nimport { Redirect } from \"react-router-dom\";\nclass ChatPage extends Component {\n  _isMounted = false;\n  constructor(props) {\n    super(props);\n    this.state = {\n      msg: \"\",\n      chat: [],\n      redirectTo: null,\n    };\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n  componentDidMount() {\n    this._isMounted = true;\n    this.props.socket.emit(\"connect_to\", { socket: this.props.id });\n    this.props.socket.on(\"connect_to\", (data) => {\n      //this.setState({ chat: data });\n      if (data.error) {\n        this.props.addFlash({ success: false, msg: data.error.msg });\n        if (this._isMounted) {\n          this.setState({ redirectTo: \"/\" });\n        }\n      } else {\n        if (this._isMounted) {\n          console.log(data);\n          this.setState({ chat: data });\n        }\n      }\n    });\n    this.props.socket.on(\"chat_message\", (data) => {\n      console.log(data);\n      if (this._isMounted) {\n        this.setState({\n          chat: [...this.state.chat, { user: data.user, msg: data.msg }],\n        });\n        if (this.props.username === data.user) {\n          this.chatbox.scrollTo(0, this.chatbox.scrollHeight);\n        }\n      }\n    });\n  }\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n  onTextChange = (e) => {\n    this.setState({ [e.target.name]: e.target.value });\n  };\n\n  handleSubmit(event) {\n    event.preventDefault();\n    console.log(\"hello\");\n\n    this.props.socket.emit(\"chat_message\", {\n      user: this.props.username,\n      msg: this.state.msg,\n    });\n    if (this._isMounted) {\n      this.setState({ msg: \"\" });\n    }\n  }\n\n  renderChat() {\n    const { chat } = this.state;\n    return chat.map(({ user, msg }, idx) => {\n      if (user === this.props.username) {\n        return <ChatLogs key={idx} msg={msg} user={user} />;\n      }\n    });\n  }\n\n  render() {\n    if (this.state.redirectTo) {\n      return <Redirect to={{ pathname: this.state.redirectTo }} />;\n    } else {\n      return (\n        <div className=\"background ss\">\n          <div\n            className=\"card\n           cscard chat\"\n          >\n            <div className=\"chatbox ss3\" ref={(c) => (this.chatbox = c)}>\n              {this.renderChat()}\n            </div>\n            <form onSubmit={this.handleSubmit} className=\"input-group mb-3\">\n              <div className=\"input-group-prepend\">\n                <button className=\"btn text-left  csnav-btn \" type=\"submit\">\n                  Send\n                </button>\n              </div>\n              <input\n                onChange={(e) => this.onTextChange(e)}\n                value={this.state.msg}\n                name=\"msg\"\n                className=\"form-control\"\n                placeholder=\"\"\n                type=\"text\"\n              />\n            </form>\n          </div>\n        </div>\n      );\n    }\n  }\n}\n\nexport default ChatPage;\n"]},"metadata":{},"sourceType":"module"}