{"ast":null,"code":"import _toConsumableArray from\"/home/amadeus/react-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _defineProperty from\"/home/amadeus/react-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _classCallCheck from\"/home/amadeus/react-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/amadeus/react-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"/home/amadeus/react-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"/home/amadeus/react-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/amadeus/react-chat/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import ChatLogs from\"./chatLogs\";import{Redirect}from\"react-router-dom\";var ChatPage=/*#__PURE__*/function(_Component){_inherits(ChatPage,_Component);var _super=_createSuper(ChatPage);function ChatPage(props){var _this;_classCallCheck(this,ChatPage);_this=_super.call(this,props);_this._isMounted=false;_this.onTextChange=function(e){_this.setState(_defineProperty({},e.target.name,e.target.value));};_this.state={msg:\"\",chat:[],redirectTo:null,id:null};_this.handleSubmit=_this.handleSubmit.bind(_assertThisInitialized(_this));return _this;}_createClass(ChatPage,[{key:\"componentDidMount\",value:function componentDidMount(){var _this2=this;this._isMounted=true;this.setState({id:this.props.id});this.props.socket.emit(\"connect_to\",{socket:this.props.id});this.props.socket.on(\"connect_to\",function(data){if(data.error){_this2.props.addFlash({success:false,msg:data.error.msg});if(_this2._isMounted){_this2.setState({redirectTo:\"/\"});}}else{if(_this2._isMounted){_this2.setState({chat:data});}}});this.props.socket.on(\"message\",function(data){if(_this2._isMounted){_this2.setState({chat:[].concat(_toConsumableArray(_this2.state.chat),[{user:data.user,msg:data.msg}])});if(_this2.props.username===data.user){_this2.chatbox.scrollTo(0,_this2.chatbox.scrollHeight);}}});}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){if(this.props.id!==this.state.id){this.props.socket.emit(\"connect_to\",{socket:this.props.id});this.setState({id:this.props.id});}}},{key:\"componentWillUnmount\",value:function componentWillUnmount(){this._isMounted=false;}},{key:\"handleSubmit\",value:function handleSubmit(event){event.preventDefault();this.props.socket.emit(\"message\",{user:{username:this.props.username,id:this.props.userid},msg:this.state.msg});if(this._isMounted){this.setState({msg:\"\"});}}},{key:\"renderChat\",value:function renderChat(){var _this3=this;var chat=this.state.chat;return chat.map(function(_ref,idx){var user=_ref.user,msg=_ref.msg;if(user.id===_this3.props.userid){return/*#__PURE__*/React.createElement(ChatLogs,{ifMe:true,msg:msg,user:user,key:idx});}else{return/*#__PURE__*/React.createElement(ChatLogs,{ifMe:false,msg:msg,user:user,key:idx});}});}},{key:\"render\",value:function render(){var _this4=this;if(this.state.redirectTo){return/*#__PURE__*/React.createElement(Redirect,{to:{pathname:this.state.redirectTo}});}else{return/*#__PURE__*/React.createElement(\"div\",{className:\"container chatpage\"},/*#__PURE__*/React.createElement(\"div\",{className:\" card cscard chat\"},/*#__PURE__*/React.createElement(\"div\",{className:\"chatbox ss3\",ref:function ref(c){return _this4.chatbox=c;}},this.renderChat()),/*#__PURE__*/React.createElement(\"form\",{onSubmit:this.handleSubmit,className:\"input-group mb-3 card-body\"},/*#__PURE__*/React.createElement(\"div\",{className:\"input-group-prepend\"},/*#__PURE__*/React.createElement(\"button\",{className:\"btn text-left  csnav-btn \",type:\"submit\"},\"Send\")),/*#__PURE__*/React.createElement(\"input\",{className:\"form-control\",onChange:function onChange(e){return _this4.onTextChange(e);},value:this.state.msg,name:\"msg\",placeholder:\"\",type:\"text\"}))));}}}]);return ChatPage;}(Component);export default ChatPage;","map":{"version":3,"sources":["/home/amadeus/react-chat/frontend/src/componets/chat/chatPage.js"],"names":["React","Component","ChatLogs","Redirect","ChatPage","props","_isMounted","onTextChange","e","setState","target","name","value","state","msg","chat","redirectTo","id","handleSubmit","bind","socket","emit","on","data","error","addFlash","success","user","username","chatbox","scrollTo","scrollHeight","event","preventDefault","userid","map","idx","pathname","c","renderChat"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\nimport ChatLogs from \"./chatLogs\";\nimport { Redirect } from \"react-router-dom\";\nclass ChatPage extends Component {\n  _isMounted = false;\n  constructor(props) {\n    super(props);\n    this.state = {\n      msg: \"\",\n      chat: [],\n      redirectTo: null,\n      id: null,\n    };\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n  componentDidMount() {\n    this._isMounted = true;\n    this.setState({ id: this.props.id });\n    this.props.socket.emit(\"connect_to\", { socket: this.props.id });\n    this.props.socket.on(\"connect_to\", (data) => {\n      if (data.error) {\n        this.props.addFlash({ success: false, msg: data.error.msg });\n        if (this._isMounted) {\n          this.setState({ redirectTo: \"/\" });\n        }\n      } else {\n        if (this._isMounted) {\n          this.setState({ chat: data });\n        }\n      }\n    });\n    this.props.socket.on(\"message\", (data) => {\n      if (this._isMounted) {\n        this.setState({\n          chat: [...this.state.chat, { user: data.user, msg: data.msg }],\n        });\n        if (this.props.username === data.user) {\n          this.chatbox.scrollTo(0, this.chatbox.scrollHeight);\n        }\n      }\n    });\n  }\n  componentDidUpdate() {\n    if (this.props.id !== this.state.id) {\n      this.props.socket.emit(\"connect_to\", { socket: this.props.id });\n      this.setState({ id: this.props.id });\n    }\n  }\n  componentWillUnmount() {\n    this._isMounted = false;\n  }\n  onTextChange = (e) => {\n    this.setState({ [e.target.name]: e.target.value });\n  };\n\n  handleSubmit(event) {\n    event.preventDefault();\n    this.props.socket.emit(\"message\", {\n      user: { username: this.props.username, id: this.props.userid },\n      msg: this.state.msg,\n    });\n    if (this._isMounted) {\n      this.setState({ msg: \"\" });\n    }\n  }\n\n  renderChat() {\n    const { chat } = this.state;\n    return chat.map(({ user, msg }, idx) => {\n      if (user.id === this.props.userid) {\n        return <ChatLogs ifMe={true} msg={msg} user={user} key={idx} />;\n      } else {\n        return <ChatLogs ifMe={false} msg={msg} user={user} key={idx} />;\n      }\n    });\n  }\n\n  render() {\n    if (this.state.redirectTo) {\n      return <Redirect to={{ pathname: this.state.redirectTo }} />;\n    } else {\n      return (\n        <div className=\"container chatpage\">\n          <div\n            className=\" card\n           cscard chat\"\n          >\n            <div className=\"chatbox ss3\" ref={(c) => (this.chatbox = c)}>\n              {this.renderChat()}\n            </div>\n            <form\n              onSubmit={this.handleSubmit}\n              className=\"input-group mb-3 card-body\"\n            >\n              <div className=\"input-group-prepend\">\n                <button className=\"btn text-left  csnav-btn \" type=\"submit\">\n                  Send\n                </button>\n              </div>\n              <input\n                className=\"form-control\"\n                onChange={(e) => this.onTextChange(e)}\n                value={this.state.msg}\n                name=\"msg\"\n                placeholder=\"\"\n                type=\"text\"\n              />\n            </form>\n          </div>\n        </div>\n      );\n    }\n  }\n}\n\nexport default ChatPage;\n"]},"metadata":{},"sourceType":"module"}